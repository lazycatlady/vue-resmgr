(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-21395a54"],{"7f7f":function(e,t,a){var i=a("86cc").f,s=Function.prototype,n=/^\s*function ([^ (]*)/,l="name";l in s||a("9e1e")&&i(s,l,{configurable:!0,get:function(){try{return(""+this).match(n)[1]}catch(e){return""}}})},"9b28":function(e,t,a){"use strict";var i=a("ea33"),s=a.n(i);s.a},ea33:function(e,t,a){},fb92:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",[a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-form",{attrs:{inline:!0,model:e.filters}},[a("el-form-item",[e._v("模糊查询:")]),a("el-form-item",{attrs:{"item-width":"300px"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},on:{change:e.changeSelectQuery},model:{value:e.filters.columns,callback:function(t){e.$set(e.filters,"columns",t)},expression:"filters.columns"}},e._l(e.resRows,function(t){return"10"!=t.PROPERTY_TYPE?a("el-option",{key:t.COLUMN_CNAME,attrs:{label:t.COLUMN_CNAME,value:t.COLUMN_NAME}}):e._e()}))],1),a("el-form-item",["2"==e.selectObj.PROPERTY_TYPE||"4"==e.selectObj.PROPERTY_TYPE?a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.filters.value,callback:function(t){e.$set(e.filters,"value",t)},expression:"filters.value"}},e._l(e.selectObj["data"],function(e){return a("el-option",{key:e.id,attrs:{label:e.NAME,value:e.id}})})):a("el-input",{attrs:{placeholder:"模糊查询"},model:{value:e.filters.name,callback:function(t){e.$set(e.filters,"name",t)},expression:"filters.name"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},on:{click:e.queryDataClick}},[e._v("查询")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-plus"},on:{click:e.handleAdd}},[e._v("新增")])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-download"},on:{click:e.handleExport}},[e._v("导出")])],1)],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.resDatas,"header-cell-class-name":"table_th",stripe:"",border:"","max-height":e.tableHeight},on:{"selection-change":e.selsChange}},[a("el-table-column",{attrs:{fixed:"left",type:"selection",width:"50",align:"center"}}),a("el-table-column",{attrs:{fixed:"left",type:"index",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.$index+(e.pageNumber-1)*e.pageSize+1)+" ")])]}}])}),a("el-table-column",{attrs:{fixed:"left",label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleEdit(t.row[e.primaryKey])}}},[e._v("编辑")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.handleDelete(t.row)}}},[e._v("删除")])]}}])}),e._l(e.resRows,function(t,i){return"10"!=t.PROPERTY_TYPE?a("el-table-column",{key:i,attrs:{prop:t.COLUMN_NAME,fixed:1==t.IS_FROZEN&&"left",label:t.COLUMN_CNAME,"min-width":""!=t.COLUMNLENGTH?t.COLUMNLENGTH:150,sortable:""}}):e._e()})],2),a("el-col",{staticClass:"toolbar",attrs:{span:24}},[a("el-button",{attrs:{type:"danger",disabled:0===this.sels.length},on:{click:e.batchRemove}},[e._v("批量删除")]),a("el-pagination",{staticStyle:{float:"right"},attrs:{background:"","current-page":e.pageNumber,"page-sizes":[30,60,100,150],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)},s=[],n=(a("28a5"),a("7f7f"),a("cadf"),a("551c"),a("097d"),{name:"resList",data:function(){return{filters:{columns:"",name:"",value:""},resRows:[],resDatas:[],total:0,pageNumber:1,pageSize:30,listLoading:!1,sels:[],selectObj:{},tableHeight:600}},computed:{tableId:function(){return this.$store.state.tableId?this.$store.state.tableId:this.$route.query.tableId},primaryKey:function(){var e="";return this.resRows.map(function(t){"10"==t.PROPERTY_TYPE&&(e=t.COLUMN_NAME)}),e}},methods:{changeSelectQuery:function(e){this.selectObj=this.resRows.filter(function(t){return t.COLUMN_NAME==e})[0],"2"!=this.selectObj.PROPERTY_TYPE&&"4"!=this.selectObj.PROPERTY_TYPE||this.getSjzdData("data",this.selectObj.typesql)},getConfig:function(){var e=this;this.$ajax.get(this.$api.getTableColumns,{flag:"list",tableId:this.tableId}).then(function(t){e.resRows=t.data,e.listLoading=!1})},queryDataClick:function(){this.pageNumber=1,"Array"==this.$util.typeOfObj(this.filters.value)?this.filters.name=this.filters.value.join(","):this.filters.name=this.filters.value,this.getResList()},getResList:function(){var e=this,t={tableId:this.tableId,pageNumber:this.pageNumber,pageSize:this.pageSize};""!=this.filters.name&&(t.queryColumn=this.filters.columns,t.queryKey=this.filters.name),this.$ajax.get(this.$api.queryTableData,t).then(function(t){t.data&&(e.resDatas=t.data.data,e.total=parseInt(t.data.count),e.listLoading=!1)})},handleExport:function(){var e={tableId:this.tableId};""!=this.filters.name&&(e.queryColumn=this.filters.columns,e.queryKey=this.filters.name),this.$ajax.getBolb(this.$api.exportExcel,e).then(function(e){if(e.data){var t=URL.createObjectURL(e.data),a=e.headers["content-disposition"].split("=")[1];a=decodeURI(a);var i=document.createElement("a");i.style.display="none",i.href=t,i.setAttribute("id","downloadLink"),i.setAttribute("download",a),document.body.appendChild(i),i.click();var s=document.getElementById("downloadLink");document.body.removeChild(s)}})},handleAdd:function(){this.$router.push({path:"/resEdit",query:{tableId:this.tableId,type:"add"}})},handleEdit:function(e){this.$router.push({path:"/resEdit",query:{tableId:this.tableId,id:e,type:"edit"}})},handleDelete:function(e){var t=this;this.$message.confirmDelete(function(){var a=t.$util.objToFormData(e);a.append("tableId",t.tableId),t.$ajax.post(t.$api.deleteTableData,a).then(function(e){e.data&&1==e.data.data?(t.$message.deleteSuccess(),t.getResList()):t.$message.deleteError(e.data.errmsg)})})},handleCurrentChange:function(e){this.pageNumber=e,this.getResList()},selsChange:function(e){this.sels=e},batchRemove:function(){var e=this,t=this.sels.map(function(t){return t[e.primaryKey]});console.log(t),this.$confirm("确认删除选中记录吗？","提示",{type:"warning"}).then(function(){var a={};a[e.primaryKey]=t,a["tableId"]=e.tableId,e.$ajax.post(e.$api.deleteTableData,a).then(function(t){t&&t.data&&t.data.data>0&&(e.$message({message:"删除成功",type:"success"}),e.getResList())})}).catch(function(){})},getSjzdData:function(e,t){var a=this;this.$ajax.get(this.$api.getDropDownListData,{typesql:t}).then(function(t){a.$set(a.selectObj,e,t.data)})}},mounted:function(){this.getConfig(),this.getResList();var e=window.innerHeight;this.tableHeight=e-220},watch:{tableId:function(){this.getConfig(),this.getResList()}}}),l=n,r=(a("9b28"),a("2877")),o=Object(r["a"])(l,i,s,!1,null,"2c9efd12",null);o.options.__file="ResList.vue";t["default"]=o.exports}}]);